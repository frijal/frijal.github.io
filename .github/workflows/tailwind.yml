name: 🚀 Build, Commit, & Deploy Tailwind CSS

on:
  schedule:
    - cron: '0 19 */14 * *' # 19:00 UTC = 03:00 WITA (keesokan harinya)
  workflow_dispatch:

permissions:
  # DIUBAH: Harus 'write' agar bisa commit kembali ke repo
  contents: write
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ${{ github.workspace }}
    steps:
      - name: 📦 Checkout repository
        uses: actions/checkout@v4

      - name: ⚙️ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: 📥 Install dependencies
        run: npm install

      - name: 🎨 Build Tailwind CSS
        run: npx tailwindcss -c ./sementara/tailwind.config.js -i ./sementara/input.css -o ./ext/tailwind.css
      
      # --- LANGKAH BARU DITAMBAHKAN DI SINI ---
      - name: 💾 Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Pesan commit yang akan muncul di riwayat repo Anda
          commit_message: 🤖 Bot: Build and update tailwind.css
          # Beri tahu action file mana yang harus di-commit
          file_pattern: ext/tailwind.css
          # Anda bisa menambahkan branch target jika perlu, misal: 'main'
          # push_options: --force

      # --- Sisa alur kerja Anda tetap sama ---
      - name: 🏗️ Prepare staging directory
        run: |
          mkdir -p ./_site
          rsync -avR . ./_site \
            --include="*/" \
            --include="*.html" \            
            --include="ext/tailwind.css" \
            --exclude="*"

      - name: 📂 Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./_site
          
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: 🚀 Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

